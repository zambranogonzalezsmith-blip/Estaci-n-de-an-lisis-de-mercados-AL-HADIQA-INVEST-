<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALHADIQA TERMINAL | v5.0 FINAL</title>
    
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    
    <style>
        /* --- CSS UNIFICADO --- */
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap');

        :root {
            --bg: #050608; --sidebar: #0a0c12; --card: rgba(22, 25, 37, 0.9);
            --accent: #1fd1ed; --gold: #d29922; --success: #00ff9d; --danger: #ff4a4a;
            --border: rgba(31, 209, 237, 0.15);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: var(--bg); color: #e2e8f0; font-family: 'Inter', sans-serif;
            height: 100vh; width: 100vw; overflow: hidden; display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 260px; background: var(--sidebar); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 20px; transition: 0.3s;
            z-index: 1000; position: relative;
        }
        .menu-collapsed .sidebar { margin-left: -260px; }

        /* Main Area */
        .main-content { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        
        /* Top Bar */
        .top-bar {
            height: 50px; border-bottom: 1px solid var(--border);
            display: flex; align-items: center; padding: 0 20px; justify-content: space-between;
        }

        /* GrÃ¡fico y Panel Lateral */
        .workspace { display: grid; grid-template-columns: 1fr 320px; flex: 1; }
        .chart-container { position: relative; background: #000; }
        #main-chart { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* Panel de Datos */
        .data-panel { background: var(--bg); border-left: 1px solid var(--border); padding: 15px; overflow-y: auto; }
        .card { background: var(--card); border: 1px solid var(--border); padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .signal-box { border-left: 3px solid var(--gold); padding: 10px; font-family: 'JetBrains Mono'; }
        
        /* Botones */
        button { cursor: pointer; border-radius: 4px; border: 1px solid var(--border); padding: 8px; background: #1a1e2e; color: #fff; font-size: 11px; }
        button.active { background: var(--accent); color: #000; font-weight: bold; }
        .btn-menu { border: 1px solid var(--accent); color: var(--accent); background: none; margin-right: 15px; }

        /* Modal */
        #crypto-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: #0d0f14; border: 1px solid var(--gold); padding: 30px; text-align: center; border-radius: 4px; }
    </style>
</head>
<body class="menu-collapsed">

    <aside class="sidebar">
        <h2 style="color:var(--accent)">ALHADIQA</h2>
        <p style="color:var(--gold); font-size: 10px; margin-bottom: 20px;">INSTITUTIONAL TERMINAL</p>
        <button onclick="abrirPasarela()">ðŸ’³ KIRA PAY SECURE</button>
    </aside>

    <main class="main-content">
        <header class="top-bar">
            <div>
                <button class="btn-menu" onclick="toggleMenu()">SYSTEM_CORE</button>
                <span id="asset-display" style="font-family: 'JetBrains Mono'; font-size: 12px;">BTC/USDT</span>
            </div>
            <div id="clock" style="font-family: 'JetBrains Mono'; font-size: 12px; color: var(--gold);">00:00:00 UTC</div>
        </header>

        <div class="workspace">
            <section class="chart-container">
                <div id="main-chart"></div>
            </section>

            <aside class="data-panel">
                <div class="card" style="border-top: 2px solid var(--gold);">
                    <small>KIRA_ALGO_v5.0</small>
                    <div class="signal-box">
                        <span id="signal-action" style="color:var(--accent)">SCANNING...</span>
                    </div>
                </div>

                <div class="card">
                    <h1 id="price-live" style="color:var(--success)">$0.00</h1>
                    <div style="display: flex; gap: 5px; margin-top: 10px;">
                        <button class="tf-btn" onclick="setTF('1m')">1M</button>
                        <button class="tf-btn active" onclick="setTF('15m')">15M</button>
                        <button class="tf-btn" onclick="setTF('1h')">1H</button>
                    </div>
                </div>

                <select id="asset-select" onchange="updateAsset()" style="width:100%; padding:10px; background:#000; color:white; border:1px solid var(--border)">
                    <option value="BTC">BITCOIN (BTC/USDT)</option>
                    <option value="ETH">ETHEREUM (ETH/USDT)</option>
                </select>
            </aside>
        </div>
    </main>

    <div id="crypto-modal">
        <div class="modal-content">
            <h3 style="color:var(--gold)">GATEWAY SECURE</h3>
            <img id="qr" src="" style="background:white; padding:10px; margin:20px 0; width:150px;">
            <code id="wallet" style="display:block; font-size:10px; color:var(--accent); margin-bottom:20px;">0x...</code>
            <button onclick="document.getElementById('crypto-modal').style.display='none'">CERRAR</button>
        </div>
    </div>

    <script>
        /* --- JS MAESTRO --- */
        let chart, series, socket;
        let config = { asset: 'BTC', tf: '15m' };
        const symbols = { 'BTC': 'btcusdt', 'ETH': 'ethusdt' };

        function init() {
            const el = document.getElementById('main-chart');
            chart = LightweightCharts.createChart(el, {
                width: el.clientWidth, height: el.clientHeight,
                layout: { background: { color: '#000000' }, textColor: '#7982a9' },
                grid: { vertLines: { color: '#0f111a' }, horzLines: { color: '#0f111a' } },
                timeScale: { borderColor: '#1f2335', timeVisible: true }
            });
            series = chart.addCandlestickSeries({ upColor: '#00ff9d', downColor: '#ff4a4a', borderVisible: false });
            
            window.addEventListener('resize', () => {
                chart.applyOptions({ width: el.clientWidth, height: el.clientHeight });
            });
            
            updateAsset();
        }

        async function updateAsset() {
            config.asset = document.getElementById('asset-select').value;
            const sym = symbols[config.asset];
            if(socket) socket.close();

            // Historial
            const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${sym.toUpperCase()}&interval=${config.tf}&limit=200`);
            const data = await res.json();
            series.setData(data.map(d => ({ time: d[0]/1000, open: +d[1], high: +d[2], low: +d[3], close: +d[4] })));

            // Realtime
            socket = new WebSocket(`wss://stream.binance.com:9443/ws/${sym}@kline_${config.tf}`);
            socket.onmessage = e => {
                const k = JSON.parse(e.data).k;
                const candle = { time: k.t/1000, open: +k.o, high: +k.h, low: +k.l, close: +k.c };
                series.update(candle);
                document.getElementById('price-live').innerText = `$${candle.close.toLocaleString()}`;
                document.getElementById('signal-action').innerText = "LIQUIDITY_FOUND";
            };
        }

        function setTF(tf) {
            config.tf = tf;
            document.querySelectorAll('.tf-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase() === tf));
            updateAsset();
        }

        function toggleMenu() {
            document.body.classList.toggle('menu-collapsed');
            setTimeout(() => {
                const el = document.getElementById('main-chart');
                chart.applyOptions({ width: el.clientWidth, height: el.clientHeight });
            }, 300);
        }

        function abrirPasarela() {
            const w = "0x3D88C06C786a3449377708705F6fE6306c368686";
            document.getElementById('crypto-modal').style.display='flex';
            document.getElementById('qr').src = `https://api.qrserver.com/v1/create-qr-code/?data=${w}`;
            document.getElementById('wallet').innerText = w;
        }

        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB', {timeZone:'UTC'}) + ' UTC';
        }, 1000);

        window.onload = init;
    </script>
</body>
</html>
