<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alhadiqa Invest | HQ Terminal & Kira Pay</title>
    
    <link rel="icon" type="image/jpeg" href="icon.jpg">
    <link rel="apple-touch-icon" href="icon.jpg">
    <link rel="stylesheet" href="style.css">
    
    <script src="chart-lib.js"></script>
</head>
<body class="menu-collapsed">
    
    <div id="lib-error" style="display:none; position:fixed; top:0; left:0; width:100%; background:#f23645; color:white; text-align:center; z-index:9999; padding:12px; font-family: sans-serif;">
        ‚ö†Ô∏è <strong>ERROR DE CARGA:</strong> Motor de gr√°ficos no detectado. Intentando recuperaci√≥n...
    </div>

    <button id="menu-toggle" onclick="toggleMenu()" title="Configuraci√≥n y Navegaci√≥n">
        <span class="icon">‚ò∞</span> <small>MEN√ö</small>
    </button>

    <div class="dashboard-wrapper">
        <nav class="sidebar" id="sidebar">
            <div class="brand">
                <img src="icon.jpg" alt="Logo" class="main-logo" onerror="this.style.display='none'">
                <div class="brand-text">
                    <span class="name">ALHADIQA</span>
                    <span class="sub">INVEST TERMINAL</span>
                </div>
            </div>

            <div class="menu-section">
                <small class="menu-title">OPERATIVA</small>
                <ul class="nav-links">
                    <li class="active"><a href="index.html">üìà Terminal de Trading</a></li>
                    <li><a href="#" onclick="abrirPasarela()">üíé Pagar con Crypto</a></li>
                    <li><a href="https://www.investing.com/economic-calendar/" target="_blank">üìÖ Calendario Econ√≥mico</a></li>
                </ul>
            </div>

            <div class="menu-section">
                <small class="menu-title">HERRAMIENTAS KIRA</small>
                <ul class="nav-links">
                    <li><a href="#" onclick="ejecutarDiagnostico()">üîç Test de Latencia</a></li>
                    <li><a href="#" onclick="alert('Historial de se√±ales en desarrollo')">üìú Registro de Alertas</a></li>
                </ul>
            </div>

            <div class="sidebar-footer">
                <div class="status-indicator">
                    <div class="dot green"></div>
                    <span>SERVIDOR: ONLINE</span>
                </div>
                <button class="close-sidebar" onclick="toggleMenu()">COLAPSAR PANEL ‚Üê</button>
            </div>
        </nav>

        <main class="main-content">
            <header id="status-banner" class="neutral">
                <div class="signal-badge" id="signal-text">ESPERANDO DATOS...</div>
            </header>

            <div class="content-grid">
                <section class="chart-area" id="main-chart"></section>

                <aside class="info-panel">
                    
                    <div class="card kira-panel" id="kira-terminal">
                        <div class="kira-header">
                            <span class="tag-gold">ALGO KIRA 1.0</span>
                            <div id="session-indicator" class="session-badge">SUIZA/LONDRES</div>
                        </div>
                        
                        <div class="kira-data-grid">
                            <div class="data-box">
                                <small>SPREAD</small>
                                <span id="kira-spread" class="highlight">0.0 pips</span>
                            </div>
                            <div class="data-box">
                                <small>LOTES SNIPER</small>
                                <strong id="suggested-lot" class="highlight">0.01</strong>
                            </div>
                        </div>

                        <div id="kira-signal-box" class="kira-wait">
                            <span id="kira-action">ESCANER ACTIVO...</span>
                        </div>

                        <div class="risk-calculator" style="margin-top:10px;">
                            <label class="label">BALANCE CUENTA (USD)</label>
                            <input type="number" id="kira-balance" value="1000" step="100" onchange="calcularLotaje()">
                        </div>
                    </div>

                    <div class="card selector-card">
                        <label class="label">TEMPORALIDAD</label>
                        <div class="timeframe-grid">
                            <button class="tf-btn" onclick="cambiarTF('1m')">1M</button>
                            <button class="tf-btn" onclick="cambiarTF('5m')">5M</button>
                            <button class="tf-btn active" onclick="cambiarTF('15m')">15M</button>
                            <button class="tf-btn" onclick="cambiarTF('1h')">1H</button>
                        </div>

                        <label class="label" style="margin-top:15px; display:block;">ACTIVO</label>
                        <select id="asset-selector" class="dark-select" onchange="cargarActivo()">
                            <optgroup label="CRIPTO">
                                <option value="BTC" selected>BITCOIN / USD</option>
                                <option value="ETH">ETHEREUM / USD</option>
                            </optgroup>
                            <optgroup label="FOREX">
                                <option value="EURUSD">EUR / USD</option>
                                <option value="GBPUSD">GBP / USD</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="card price-display">
                        <div class="price-info">
                            <span id="asset-name" class="asset-title">BITCOIN</span>
                            <span id="current-price" class="price-value">$0.00</span>
                        </div>
                        <div class="rsi-bar">
                            <small>RSI (14): <span id="rsi-value">--</span></small>
                            <div class="rsi-track"><div id="rsi-fill" style="width: 50%"></div></div>
                        </div>
                    </div>

                </aside>
            </div>
        </main>
    </div>

    <div id="crypto-modal">
        <div class="payment-card">
            <h3 style="color:var(--gold); margin-bottom:5px;">KIRA PAY SECURE</h3>
            <p style="font-size:11px; color:#8b949e;">Deposite USDT (BEP20) para fondear cuenta</p>
            
            <div class="qr-container">
                <img id="qr-deposit" src="" alt="QR Dep√≥sito">
            </div>
            
            <div class="wallet-address-box" id="wallet-addr" onclick="copyWallet()">
                Cargando billetera...
            </div>

            <button class="btn-metamask" onclick="conectarMetaMask()">CONECTAR BILLETERA</button>
            <br>
            <button onclick="cerrarPasarela()" style="background:none; border:none; color:var(--danger); cursor:pointer; margin-top:15px; font-size:12px;">Cancelar Operaci√≥n</button>
        </div>
    </div>

    <script>
        // Funciones de UI b√°sicas
        function toggleMenu() {
            document.body.classList.toggle('menu-collapsed');
            setTimeout(() => { if(window.chart) window.dispatchEvent(new Event('resize')); }, 300);
        }

        function abrirPasarela() {
            document.getElementById('crypto-modal').style.display = 'flex';
            // Aqu√≠ llamar√≠as a la l√≥gica de KIRA_PAY para generar el QR
            if(window.KIRA_PAY) KIRA_PAY.abrir();
        }

        function cerrarPasarela() {
            document.getElementById('crypto-modal').style.display = 'none';
        }

        function copyWallet() {
            const addr = document.getElementById('wallet-addr').innerText;
            navigator.clipboard.writeText(addr);
            alert("Billetera copiada");
        }
    </script>
    <script src="script.js"></script>
</body>
</html>
