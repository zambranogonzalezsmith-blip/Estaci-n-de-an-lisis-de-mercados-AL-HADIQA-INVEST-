<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>AL-HADIQA INVEST | REAL-TIME MARKET ARCHITECT</title>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        :root {
            --bg: #050505; --panel: #0e1015; --gold: #d4af37; --cyan: #00f2ea;
            --win: #00e676; --loss: #ff1744; --border: rgba(212, 175, 55, 0.2);
        }
        * { box-sizing: border-box; font-family: 'JetBrains Mono', monospace; margin: 0; padding: 0; }
        body { background: var(--bg); color: #cfd8dc; height: 100vh; display: flex; overflow: hidden; }

        /* LAYOUT */
        .workspace { display: flex; width: 100%; height: 100%; }
        .chart-zone { flex: 1; position: relative; border-right: 2px solid var(--border); }
        .control-panel { width: 420px; background: var(--panel); padding: 20px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; border-left: 1px solid var(--border); }

        /* BRANDING */
        .watermark { position: absolute; top: 20px; left: 20px; z-index: 20; background: rgba(0,0,0,0.8); padding: 10px 15px; border-left: 4px solid var(--gold); pointer-events: none; }
        .brand-main { font-size: 16px; font-weight: 900; color: var(--gold); letter-spacing: 2px; }

        /* LUX ARROW (VISUAL CONFIRMATION) */
        .lux-overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 50; text-align: center; display: none; pointer-events: none;
        }
        .arrow-icon { font-size: 120px; filter: drop-shadow(0 0 30px currentColor); animation: pulse 1.5s infinite; }
        .arrow-text { background: #000; padding: 8px 20px; border: 1px solid currentColor; font-weight: bold; margin-top: 10px; font-size: 16px; color: #fff; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }

        /* PANEL ELEMENTS */
        .widget-box { border: 1px solid #333; border-radius: 6px; overflow: hidden; background: #000; }
        .panel-title { font-size: 11px; color: var(--gold); margin-bottom: 8px; letter-spacing: 1px; font-weight: bold; }

        /* LIVE PRICE DISPLAY */
        .live-ticker { 
            font-size: 28px; font-weight: bold; color: #fff; text-align: center; 
            padding: 15px; border: 1px solid var(--cyan); border-radius: 4px; 
            background: linear-gradient(180deg, rgba(0,242,234,0.1), transparent);
            text-shadow: 0 0 10px rgba(0,242,234,0.5);
        }

        /* ACTION BUTTONS */
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .btn-action {
            padding: 15px; border: none; font-weight: bold; cursor: pointer; color: #000; font-size: 12px;
            transition: 0.3s; text-transform: uppercase;
        }
        .btn-long { background: var(--win); box-shadow: 0 0 15px rgba(0,230,118,0.2); }
        .btn-long:hover { background: #00c853; transform: translateY(-2px); }
        .btn-short { background: var(--loss); box-shadow: 0 0 15px rgba(255,23,68,0.2); }
        .btn-short:hover { background: #d50000; transform: translateY(-2px); }

        /* RESULTS CARD */
        .result-card { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 4px; display: none; border-left: 4px solid #666; }
        .data-row { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 8px; border-bottom: 1px solid #222; padding-bottom: 4px; }
        .data-val { font-weight: bold; }

    </style>
</head>
<body>

    <div class="workspace">
        <div class="chart-zone">
            <div class="watermark">
                <div class="brand-main">AL-HADIQA INVEST</div>
                <div style="font-size: 9px; color: var(--cyan);">REAL-TIME DATA FEED // V.9</div>
            </div>

            <div id="lux-visual" class="lux-overlay">
                <div id="lux-arrow" class="arrow-icon">▲</div>
                <div id="lux-msg" class="arrow-text">PLAN EJECUTADO</div>
            </div>

            <div id="tv-chart" style="width:100%; height:100%"></div>
        </div>

        <aside class="control-panel">
            
            <div>
                <div class="panel-title">PRECIO LIVE (BINANCE API)</div>
                <div id="btc-price" class="live-ticker">Cargando...</div>
            </div>

            <div>
                <div class="panel-title">ANÁLISIS DE MERCADO (CONSENSUS)</div>
                <div class="widget-box" style="height: 300px;">
                    <div class="tradingview-widget-container">
                        <div class="tradingview-widget-container__widget"></div>
                        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js" async>
                        {
                        "interval": "15m",
                        "width": "100%",
                        "isTransparent": true,
                        "height": "100%",
                        "symbol": "BINANCE:BTCUSDT",
                        "showIntervalTabs": true,
                        "displayMode": "single",
                        "locale": "es",
                        "colorTheme": "dark"
                        }
                        </script>
                    </div>
                </div>
                <div style="font-size: 10px; color: #666; margin-top: 5px; text-align: center;">
                    *Si el medidor dice "COMPRA", usa el botón VERDE.
                </div>
            </div>

            <div>
                <div class="panel-title">GENERADOR DE ESTRATEGIA AL-HADIQA</div>
                <div class="btn-grid">
                    <button class="btn-action btn-long" onclick="generatePlan('LONG')">CONFIRMAR COMPRA (LONG)</button>
                    <button class="btn-action btn-short" onclick="generatePlan('SHORT')">CONFIRMAR VENTA (SHORT)</button>
                </div>
            </div>

            <div id="plan-output" class="result-card">
                <div style="text-align: center; color: var(--gold); font-weight: bold; margin-bottom: 10px; letter-spacing: 2px;">PLAN ACTIVO 1:3</div>
                
                <div class="data-row">
                    <span style="color:#aaa">ENTRADA (MARKET):</span>
                    <span id="res-entry" class="data-val" style="color:var(--cyan)">---</span>
                </div>
                <div class="data-row">
                    <span style="color:#aaa">STOP LOSS (0.5%):</span>
                    <span id="res-sl" class="data-val" style="color:var(--loss)">---</span>
                </div>
                <div class="data-row">
                    <span style="color:#aaa">TAKE PROFIT (1.5%):</span>
                    <span id="res-tp" class="data-val" style="color:var(--win)">---</span>
                </div>
                
                <div style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #444;">
                    <span style="font-size: 10px; color: var(--gold);">BALANCE CUENTA ($):</span>
                    <input type="number" id="user-balance" value="1000" style="background:#000; border:1px solid #444; color:#fff; width:100%; margin-top:5px; padding:5px;">
                    <div style="margin-top:10px; font-size: 12px; display:flex; justify-content:space-between;">
                        <span>LOTES RECOMENDADOS:</span>
                        <span id="res-lots" style="color:#fff; font-weight:bold;">0.00 BTC</span>
                    </div>
                </div>
            </div>

            <div style="margin-top:auto; font-size:9px; color:#444; text-align:center;">
                CONEXIÓN SEGURA: BINANCE PUBLIC STREAM<br>
                AL-HADIQA INVEST © 2026
            </div>
        </aside>
    </div>

    <script>
        let currentPrice = 0;

        // 1. INICIAR GRÁFICO
        function initChart() {
            new TradingView.widget({
                "autosize": true, "symbol": "BINANCE:BTCUSDT", "interval": "15",
                "timezone": "Etc/UTC", "theme": "dark", "container_id": "tv-chart",
                "style": "1", "allow_symbol_change": true,
                "studies": [ "MAExp@tv-basicstudies", "RSI@tv-basicstudies" ]
            });
        }

        // 2. OBTENER PRECIO REAL DE BINANCE (SIN SIMULACIONES)
        async function fetchPrice() {
            try {
                const response = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
                const data = await response.json();
                currentPrice = parseFloat(data.price);
                
                // Actualizar UI
                document.getElementById('btc-price').innerText = `$${currentPrice.toFixed(2)}`;
                
                // Efecto visual si sube o baja (opcional, simple)
                document.getElementById('btc-price').style.borderColor = "var(--cyan)";

            } catch (error) {
                console.error("Error conectando a Binance:", error);
                document.getElementById('btc-price').innerText = "OFFLINE";
            }
        }

        // 3. GENERAR PLAN 1:3 CON DATOS REALES
        function generatePlan(type) {
            if(currentPrice === 0) { alert("Esperando datos de mercado..."); return; }

            const riskPercent = 0.005; // 0.5% Riesgo (Stop Loss apretado)
            const rewardPercent = 0.015; // 1.5% Beneficio (Ratio 1:3 exacto)
            
            const slDist = currentPrice * riskPercent;
            const tpDist = currentPrice * rewardPercent;

            let sl, tp, color, arrow;

            if (type === 'LONG') {
                sl = currentPrice - slDist;
                tp = currentPrice + tpDist;
                color = "var(--win)";
                arrow = "▲";
                document.getElementById('plan-output').style.borderLeftColor = "var(--win)";
            } else {
                sl = currentPrice + slDist;
                tp = currentPrice - tpDist;
                color = "var(--loss)";
                arrow = "▼";
                document.getElementById('plan-output').style.borderLeftColor = "var(--loss)";
            }

            // Mostrar Flecha LUX
            const luxDiv = document.getElementById('lux-visual');
            luxDiv.style.display = "block";
            document.getElementById('lux-arrow').innerText = arrow;
            document.getElementById('lux-arrow').style.color = color;
            document.getElementById('lux-msg').innerText = `ORDEN ${type} CONFIRMADA`;
            document.getElementById('lux-msg').style.borderColor = color;

            // Mostrar Tarjeta de Resultados
            document.getElementById('plan-output').style.display = "block";
            document.getElementById('res-entry').innerText = `$${currentPrice.toFixed(2)}`;
            document.getElementById('res-sl').innerText = `$${sl.toFixed(2)}`;
            document.getElementById('res-tp').innerText = `$${tp.toFixed(2)}`;

            calculateLots(slDist);

            // Ocultar flecha después de 5 segundos para limpiar pantalla
            setTimeout(() => {
                luxDiv.style.display = "none";
            }, 5000);
        }

        // 4. CALCULAR LOTAJE EN VIVO
        function calculateLots(slDistance) {
            const balance = document.getElementById('user-balance').value;
            // Riesgo monetario = 1% del balance
            const riskAmount = balance * 0.01; 
            const lots = riskAmount / slDistance;
            document.getElementById('res-lots').innerText = lots.toFixed(5) + " BTC";
        }

        // Event Listeners
        window.onload = () => {
            initChart();
            fetchPrice();
            setInterval(fetchPrice, 1000); // Actualizar precio cada segundo
        };

        document.getElementById('user-balance').addEventListener('input', () => {
            // Recalcular si cambia el balance
            if(document.getElementById('res-entry').innerText !== "---") {
                const entry = parseFloat(document.getElementById('res-entry').innerText.replace('$',''));
                const sl = parseFloat(document.getElementById('res-sl').innerText.replace('$',''));
                calculateLots(Math.abs(entry - sl));
            }
        });

    </script>
</body>
</html>
